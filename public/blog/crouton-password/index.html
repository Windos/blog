<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.png">

  <title>
  Crouton #5 – Password Expiry Warning - ToastIT
  </title>
  <meta name="description" content="How the heck did that happen, isn&#39;t the system meant to give me some warning?" />
  <meta name="author" content="Josh King" />
  <meta name="generator" content="Hugo 0.101.0" /><link
    rel="stylesheet"
    href="https://blog.toastit.dev/css/styles.min.f1259c4f8868acc3e3e3f3194acb8dc973d6d46276811e77f3af9cdf78a5af42.css"
    integrity="sha256-8SWcT4horMPj4/MZSsuNyXPW1GJ2gR5386+c33ilr0I="
  />
  
  

  <meta property="og:title" content="Crouton #5 – Password Expiry Warning" />
<meta property="og:description" content="How the heck did that happen, isn&#39;t the system meant to give me some warning?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.toastit.dev/blog/crouton-password/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2018-01-25T10:30:00+00:00" />
<meta property="article:modified_time" content="2018-01-25T10:30:00+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Crouton #5 – Password Expiry Warning"/>
<meta name="twitter:description" content="How the heck did that happen, isn&#39;t the system meant to give me some warning?"/>

  <meta itemprop="name" content="Crouton #5 – Password Expiry Warning">
<meta itemprop="description" content="How the heck did that happen, isn&#39;t the system meant to give me some warning?"><meta itemprop="datePublished" content="2018-01-25T10:30:00+00:00" />
<meta itemprop="dateModified" content="2018-01-25T10:30:00+00:00" />
<meta itemprop="wordCount" content="754">
<meta itemprop="keywords" content="PowerShell,BurntToast," />
</head>
<body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative">
  <a href="https://blog.toastit.dev/" class="capitalize font-extrabold text-2xl">
    
    <img src="/toastit-logo.png" alt="ToastIT" class="h-8 max-w-full" />
    
  </a>
  <button class="mobile-menu-button md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <line x1="4" y1="8" x2="20" y2="8" />
      <line x1="4" y1="16" x2="20" y2="16" />
    </svg>
  </button>
  <ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800">

    
    <li><a href="/blog">Blog</a></li>
    
    <li><a href="/page/about/">About</a></li>
    
    <li><a href="/tags">Tags</a></li>
    
    <li><a href="/blog/emoji-support/">Top Post</a></li>
    

    

    
    <li class="grid place-items-center">
      <span class="open-search inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="10" cy="10" r="7" />
          <line x1="21" y1="21" x2="15" y2="15" />
        </svg>
      </span>
    </li>
    

    
  </ul>
</header>
<main class="flex-1">
  
  

  

  <article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">

    <h1 class="text-2xl font-bold mb-2">Crouton #5 – Password Expiry Warning</h1>
    <h5 class="text-sm flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <rect x="4" y="5" width="16" height="16" rx="2" />
        <line x1="16" y1="3" x2="16" y2="7" />
        <line x1="8" y1="3" x2="8" y2="7" />
        <line x1="4" y1="11" x2="20" y2="11" />
        <rect x="8" y="15" width="2" height="2" />
      </svg>
      Posted on 
  
    January 25, 2018
  


      
        &nbsp;&bull;&nbsp;
      
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
      4&nbsp;minutes
      &nbsp;&bull;
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <line x1="3" y1="6" x2="3" y2="19" />
        <line x1="12" y1="6" x2="12" y2="19" />
        <line x1="21" y1="6" x2="21" y2="19" />
      </svg>
      754&nbsp;words
      
    </h5>

    <p>&ldquo;Something is wrong with my computer. Outlook is asking me for my password?!&rdquo;</p>
<p>&ldquo;Let me look&hellip; Oh, it looks like your password expired about 15 minutes ago.&rdquo;</p>
<p>&ldquo;How the heck did that happen, isn&rsquo;t the system meant to give me some warning?&rdquo;</p>
<h2 id="invisible-expiry-reminders"><strong>Invisible Expiry Reminders</strong></h2>
<p>I don&rsquo;t often get these calls personally any more, but I do overhear them. There&rsquo;s no point trying to tell your user that the &lsquo;system&rsquo; did warn them (for three days by default).</p>
<p>I imagine those warnings are probably something like website ads: Invisible.</p>
<p>They are popping up; the user just didn&rsquo;t process them into something that needs to be actioned.</p>
<p>To be fair, these notifications in Windows 7 are pathetic.
<img src="__GHOST_URL__/content/images/2018/05/win7.png" alt="win7">
Windows 10 switched to toasts and they are a step up, but I think we can do better.
<img src="__GHOST_URL__/content/images/2018/05/win10.jpg" alt="win10">
<em>Note: I don&rsquo;t know what the situation was like in Windows 8/8.1, I don&rsquo;t remember ever joining that OS to a domain.</em></p>
<h2 id="get-to-the-point"><strong>Get to the Point!</strong></h2>
<p>Right, I haven&rsquo;t actually stated what the point of this post is.</p>
<p>Let&rsquo;s create our own toast notifications to remind our users that their passwords are about to expire. We&rsquo;ll make these toasts as hard to ignore as possible as they&rsquo;ll only be effective if they&rsquo;re actually seen.</p>
<p>Given that we&rsquo;re using toasts, via the <a href="https://powershellgallery.com/packages/BurntToast" target="_blank" rel="noopener">BurntToast</a>
 module, this only applies to Windows 10.</p>
<p>Also, the client will need the Active Directory PowerShell module on the system. How you achieve this is up to you&hellip; this is meant to be more of a fun &ldquo;hey look what we can do&rdquo; type exercise than a complete recipe to fix an issue.</p>
<p>Finally, be warned that the examples here include backtick in order to keep the snippets narrow. Keep an eye out if you&rsquo;re copy/pasting.</p>
<h2 id="getting-into-the-code"><strong>Getting into the Code</strong></h2>
<p>Alright, enough jabber, time for the code.</p>
<p>We start by figuring out how long it is until the current user&rsquo;s password is from expiring. We get this from the computed expiry time property on their AD object, and create a timespan between &rsquo;now&rsquo; and &rsquo;then&rsquo;:</p>
<pre><code>$ExpiryTime = Get-ADUser $env:USERNAME -Properties 'msDS-UserPasswordExpiryTimeComputed'
$Expiry = [datetime]::FromFileTime($ExpiryTime.'msDS-UserPasswordExpiryTimeComputed')
$TimeToGo = New-TimeSpan -Start (Get-Date) -End $Expiry
</code></pre>
<p>We only want to show our toast if we&rsquo;re inside a three-day window of the expiry time, so let&rsquo;s test for that. Then we populate some variables for use within the toast&rsquo;s text.</p>
<p>Finally, we generate the toast!</p>
<pre><code>if ($TimeToGo -le 3) {
    if ($TimeToGo.Days -gt 0) {
        $Count = $TimeToGo.Days
        $Unit = 'Days'
    } else {
        $Count = $TimeToGo.Hours
        $Unit = 'Hours'
    }

    New-BurntToastNotification -Sound Alarm10 `
        -Text 'Your password is close to expiring!',
              &quot;Please change your password soon, it will expire in $Count $Unit.&quot;,
              'You can change it any time by pressing CTRL + ALT + DEL and choosing &quot;Change a password.&quot;'
}
</code></pre>
<p>Right, we&rsquo;ve now got code that can be run on-demand, but that won&rsquo;t do! Let&rsquo;s get this going on a schedule.</p>
<p>Imagine you&rsquo;ve wrapped all of the previous code up as a ScriptBlock and then create a Job Trigger and Job Options. Take all those components and use them a register your scheduled job.</p>
<pre><code>$JobTrigger = New-JobTrigger -Once `
                             -At &quot;01:00&quot; `
                             -RepeatIndefinitely `
                             -RepetitionInterval (New-TimeSpan -Minutes 90)

$JobOptions = New-ScheduledJobOption -RequireNetwork

Register-ScheduledJob -Name 'Password Expiry Reminder' `
                      -ScriptBlock $JobBlock `
                      -Trigger $JobTrigger `
                      -ScheduledJobOption $JobOptions
</code></pre>
<p>Unfortunately, we&rsquo;re not quite done. The current version of Windows 10 defaults to running these scheduled jobs whether or not the user is logged in and toasts won&rsquo;t work if that is the case.</p>
<p>We can fix this by borrowing from the Scheduled Task (as opposed to Scheduled Job) cmdlets and set the logon type to Interactive.</p>
<pre><code>$Principal = New-ScheduledTaskPrincipal -LogonType Interactive -UserId $ENV:USERNAME

Set-ScheduledTask -Principal $Principal `
                  -TaskPath '\Microsoft\Windows\PowerShell\ScheduledJobs\' `
                  -TaskName 'Password Expiry Reminder'
</code></pre>
<p>You&rsquo;re done! Our forgetful user will now be notified every ninety minutes regarding the impending expiry. The toast is specifically using an alarm tone, which makes is stay on the screen for longer and sounds annoying.
<img src="__GHOST_URL__/content/images/2018/05/example-1.png" alt="example-1">
If they manage to ignore these notifications, I don&rsquo;t know if there is any hope for them.</p>
<h2 id="wrap-up"><strong>Wrap-Up</strong></h2>
<p>That was a fun little exercise and I hope you took something away from it.</p>
<p>You can get the final product via <a href="https://gist.github.com/Windos/17ce81e36cc635638f30e5cb79791051" target="_blank" rel="noopener">Gist</a>
.</p>
<p>Personally, this was the first time I made use of the scheduled task cmdlet to tweak one of the jobs rather than doing it via the GUI (the more you know.)</p>
<p>Have you got any uses for toasts that make your life (or your users&rsquo; lives) easier? Let me know on <a href="https://twitter.com/WindosNZ" target="_blank" rel="noopener">twitter</a>
!</p>

  </article><div class="bg-blue-300 dark:bg-gray-900">
  <div class="container px-6 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
    <div>
      <div class="text-2xl font-bold mb-2">Follow me</div>
      <p class="opacity-60"></p>
    </div>
    <ul class="flex justify-center gap-4">
      
      <li>
        <a
          href="https://twitter.com/WindosNZ"
          target="_blank"
          rel="noopener"
          aria-label="Twitter"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"
            />
          </svg>
        </a>
      </li>
      
      
      <li>
        <a
          href="https://linkedin.com/in/windos"
          target="_blank"
          rel="noopener"
          aria-label="LinkedIn"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <line x1="8" y1="11" x2="8" y2="16" />
            <line x1="8" y1="8" x2="8" y2="8.01" />
            <line x1="12" y1="16" x2="12" y2="11" />
            <path d="M16 16v-3a2 2 0 0 0 -4 0" />
          </svg>
        </a>
      </li>
      
      
      
      <li>
        <a
          href="https://github.com/Windos"
          target="_blank"
          rel="noopener"
          aria-label="GitHub"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
            />
          </svg>
        </a>
      </li>
      
      
      
      
      
      <li>
        <a
          href="https://www.youtube.com/c/JoshuaKingSolari"
          target="_blank"
          rel="noopener"
          aria-label="YouTube"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="icon icon-tabler icon-tabler-brand-youtube"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <circle cx="12" cy="12" r="9" />
            <path d="M10 9l5 3l-5 3z" />
          </svg>
        </a>
      </li>
      
      
    </ul>
  </div>
</div>
    </main><footer class="container p-6 mx-auto flex justify-between items-center">
  <span class="text-sm font-light">
    
    Copyright © 2022 - Josh King · All rights reserved
    
  </span>
  <span onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-1 cursor-pointer">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M18 15l-6 -6l-6 6h12" />
    </svg>
  </span>
</footer>

<div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden">
  <div class="container max-w-3xl mx-auto p-12">
    <div class="relative">
      <div class="my-4 text-center text-2xl font-bold">Search</div>

      <span class="p-2 absolute right-0 top-0 cursor-pointer close-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </span>
    </div>

    <input type="search" class="py-2 px-3 w-full dark:text-black border dark:border-transparent"
      placeholder="Enter search query" />

    <div class="search-results text-lg font-medium my-4 hidden">Results</div>
    <ul class="search-list my-2">

    </ul>

    <div class="no-results text-center my-8 hidden">
      <div class="text-xl font-semibold mb-2">No results found</div>
      <p class="font-light text-sm">Try adjusting your search query</p>
    </div>
  </div>
</div>





<script src="https://blog.toastit.dev/js/scripts.min.js"></script>







<script>
  const mobileMenuButton = document.querySelector('.mobile-menu-button')
  const mobileMenu = document.querySelector('.mobile-menu')
  function toggleMenu() {
    mobileMenu.classList.toggle('hidden');
    mobileMenu.classList.toggle('flex');
  }
  if(mobileMenu && mobileMenuButton){
    mobileMenuButton.addEventListener('click', toggleMenu)
  }
</script>
</body>
</html>
