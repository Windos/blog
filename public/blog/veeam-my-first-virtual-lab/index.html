<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.png">

  <title>
  Veeam: My First Virtual Lab - ToastIT
  </title>
  <meta name="description" content="Over the last day or so I&rsquo;ve been setting up a sandbox/virtual lab which leverages our Veeam backups." /><meta name="generator" content="Hugo 0.108.0"><link
    rel="stylesheet"
    href="https://blog.toastit.dev/css/styles.min.00926f5a77daea6f795528dd203f08541988d4f18173be6e98b840cc57cd6ad6.css"
    integrity="sha256-AJJvWnfa6m95VSjdID8IVBmI1PGBc75umLhAzFfNatY="
  />



  <meta property="og:title" content="Veeam: My First Virtual Lab" />
<meta property="og:description" content="Over the last day or so I&rsquo;ve been setting up a sandbox/virtual lab which leverages our Veeam backups." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.toastit.dev/blog/veeam-my-first-virtual-lab/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2018-03-25T20:00:00+00:00" />
<meta property="article:modified_time" content="2018-03-25T20:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Veeam: My First Virtual Lab"/>
<meta name="twitter:description" content="Over the last day or so I&rsquo;ve been setting up a sandbox/virtual lab which leverages our Veeam backups."/>

  <meta itemprop="name" content="Veeam: My First Virtual Lab">
<meta itemprop="description" content="Over the last day or so I&rsquo;ve been setting up a sandbox/virtual lab which leverages our Veeam backups."><meta itemprop="datePublished" content="2018-03-25T20:00:00+00:00" />
<meta itemprop="dateModified" content="2018-03-25T20:00:00+00:00" />
<meta itemprop="wordCount" content="1527">
<meta itemprop="keywords" content="Backup," />


</head>
<body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative">
  <a href="https://blog.toastit.dev/" class="capitalize font-extrabold text-2xl">

    <img src="/toastit-logo.png" alt="ToastIT" class="h-8 max-w-full" />

  </a>
  <button class="mobile-menu-button md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <line x1="4" y1="8" x2="20" y2="8" />
      <line x1="4" y1="16" x2="20" y2="16" />
    </svg>
  </button>
  <ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800">


    <li><a href="/blog">Blog</a></li>

    <li><a href="/page/about/">About</a></li>

    <li><a href="/tags">Tags</a></li>

    <li><a href="/blog/emoji-support/">Top Post</a></li>





    <li class="grid place-items-center">
      <span class="open-search inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="10" cy="10" r="7" />
          <line x1="21" y1="21" x2="15" y2="15" />
        </svg>
      </span>
    </li>



  </ul>
</header>
<main class="flex-1">





  <article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">

    <h1 class="text-2xl font-bold mb-2">Veeam: My First Virtual Lab</h1>

    <h5 class="text-sm flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <rect x="4" y="5" width="16" height="16" rx="2" />
        <line x1="16" y1="3" x2="16" y2="7" />
        <line x1="8" y1="3" x2="8" y2="7" />
        <line x1="4" y1="11" x2="20" y2="11" />
        <rect x="8" y="15" width="2" height="2" />
      </svg>
      Posted on

    March 25, 2018




        &nbsp;&bull;&nbsp;

      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
      8&nbsp;minutes
      &nbsp;&bull;
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <line x1="3" y1="6" x2="3" y2="19" />
        <line x1="12" y1="6" x2="12" y2="19" />
        <line x1="21" y1="6" x2="21" y2="19" />
      </svg>
      1527&nbsp;words



    </h5>


    <p>Over the last day or so I&rsquo;ve been setting up a sandbox/virtual lab which leverages our Veeam backups. We&rsquo;ve been using <a href="https://www.veeam.com/videos/surebackup-how-it-works-22.html" target="_blank" rel="noopener">SureBackup</a>
 for automatic restore point verification, but a large software update that&rsquo;s coming down the pipeline was a really good excuse to get a semi-persistent lab running.</p>
<p>This post goes through the process of setting up a lab from start to finish. I&rsquo;d found posts that went through parts of the process, usually focusing on the trickier parts, but I didn&rsquo;t really find any real world, end-to-end walkthroughs.</p>
<p>Keep in mind that the following is as much for &ldquo;future me&rdquo; as anyone else, but I do hope you find this useful.</p>
<h2 id="a-powershell-caveat"><strong>A (PowerShell) Caveat</strong></h2>
<p>I&rsquo;d originally wanted to include the PowerShell method for as much of this process as possible, but unfortunately a lot of the commands just outright aren&rsquo;t working as advertised for me. This could be an issue with the version I&rsquo;m running (9.5 Update 3) or our particular VMware setup.</p>
<p>Don&rsquo;t get me wrong, <a href="https://helpcenter.veeam.com/docs/backup/powershell/getting_started.html?ver=95" target="_blank" rel="noopener">Veeam&amp;rsquo;s PowerShell support</a>
 is awesome, but if it ventures too far into the &ldquo;advanced&rdquo;, it can be a little lacking at times. If something isn&rsquo;t working, or they&rsquo;re missing something that&rsquo;s important to you, make sure you let them know!</p>
<p>In my experience Veeam&rsquo;s support team is one of the best in the industry. Don&rsquo;t hesitate to talk with them.</p>
<h2 id="the-ingredients"><strong>The Ingredients</strong></h2>
<p>Here&rsquo;s something I didn&rsquo;t realize until diving into this; despite marketing terms like &ldquo;<a href="https://helpcenter.veeam.com/docs/backup/vsphere/sandbox.html?ver=95" target="_blank" rel="noopener">On-Demand Sandbox</a>
&rdquo; being thrown around, this isn&rsquo;t actually the name of the feature so don&rsquo;t bother hunting through the console like I did. It&rsquo;s actually just another way of using SureBackup.</p>
<p>So what is involved? There&rsquo;s three components which I like to think of as the what, where, and when.</p>
<p><strong>What</strong> – Application Group</p>
<p>This defines which VMs will be part of your lab. It can also specify which special role each VM performs and any non-standard timings that are needed. For example, one of your VMs may be a domain control that takes a really long time to boot for whatever reason.</p>
<p><strong>Where</strong> – Virtual Lab</p>
<p>There&rsquo;s a bunch involved here, but at the end of the day this results in an appliance that sits in your virtual infrastructure and acts as a proxy/gateway between your lab and the rest of the network.</p>
<p><strong>When</strong> – SureBackup Job</p>
<p>This job links your Application Group with your Virtual Lab. You can set this job to run automatically at certain times (you&rsquo;d do this for automatically verifying the integrity of your restore points), but this particular job will be run on demand.</p>
<h2 id="group-your-applications"><strong>Group Your Applications</strong></h2>
<p>First, let setup our <strong>Application Group</strong>. I&rsquo;m going to assume we&rsquo;re setting up this lab to test a major software update, which is installed on <strong>APP1</strong>. This solution is supported by a database on <strong>SQL1</strong>. For good measure, I&rsquo;ll make sure we also have a Domain Controller, <strong>AD1</strong>, available for my identity needs.</p>
<p>Fire up your Backup &amp; Recovery Console, head over to the &ldquo;Backup Infrastructure&rdquo; section and look for &ldquo;Application Groups&rdquo; under SureBackup. Go ahead and create a new group, give it a descriptive name and add your VMs.</p>
<figure><img src="/2018/05/appgroup.png"/>
</figure>

<p>You&rsquo;ll note that I marked my Domain Controller for an authoritative restore (I had domain trust issues without this.) This is where you can adjust the order in which the VMs are restored, and to tweak any other VM specific settings. Have a look through, and make any changes that suit your needs.</p>
<h2 id="deploy-your-virtual-lab"><strong>Deploy Your Virtual Lab</strong></h2>
<p>Just below &ldquo;Application Groups&rdquo; in the console, you&rsquo;ll find &ldquo;Virtual Labs.&rdquo; This is a little more involved than the previous section, so prepare for a few more screenshots.</p>
<p>Again, add a Virtual Lab and give it a descriptive name.</p>
<p>Choose a host which will be the home of your lab. Unfortunately, it has to be a specific host and cannot be a cluster. The wizard will show you some stats about the host you&rsquo;ve selected, such as how many VMs are currently running on it. Also, click on &ldquo;Configure&rdquo; to define a folder into which the lab can be stored in (keeping vCenter nice and tidy.)</p>
<figure><img src="/2018/05/lab-host.png"/>
</figure>

<p>It&rsquo;s more or less the same process for a datastore, except that there&rsquo;s no customization.</p>
<figure><img src="/2018/05/lab-datastore.png"/>
</figure>

<p>Here&rsquo;s where things start to get interesting. You now need to configure the proxy appliance for this lab. Give it a name (you will see this pop up in vCenter), set which production network it should connect to, and give it a static IP address. Technically you could let it obtain one from DHCP, but you&rsquo;ll be routing traffic to this later so I prefer to not risk it moving around.</p>
<p>Also, you can tick a box here to allow the appliance to act as a proxy so that the lab can access the internet. I&rsquo;ll be assuming that this is what you want during the rest of this post.</p>
<figure><img src="/2018/05/lab-proxy.png"/>
</figure>

<p>You might be able to make use of a basic single-host networking configuration, however my environment meant I had to go for an advanced one.</p>
<figure><img src="/2018/05/lab-advanced.png"/>
</figure>

<p>The defaults on the Isolated Networks page was perfect for me. Make sure you sanity check what&rsquo;s there.</p>
<p>The next page has you configure the internal network for your lab. The two main this here is setting the address which your lab will see the proxy as and what the &ldquo;masquerade&rdquo; range should be (we&rsquo;ll touch more on what this is for later).</p>
<p>Generally, you want to set the address of the proxy to match what would normally be your network&rsquo;s gateway address, and for the masquerade range pick something that is unique on your network. In this example we&rsquo;re pretending that the production network is 10.1.1.x, the gateways is 10.1.1.254 and we&rsquo;ve set our masquerade range to 10.1.<strong>2</strong>.x.</p>
<figure><img src="/2018/05/lab-network.png"/>
</figure>

<p>I didn&rsquo;t need to define any static mappings, and just completed the wizard.</p>
<h2 id="mix-it-together-with-surebackup"><strong>Mix It Together with SureBackup</strong></h2>
<p>The simplest part of this process is creating the actual SureBackup job. Head over to the &ldquo;Home&rdquo; section and go to &ldquo;SureBackup&rdquo; under &ldquo;Jobs.&rdquo;</p>
<p>Create a new job, specifying your Application Group and Virtual Lab.</p>
<p>The only thing to watch out for is the &ldquo;Keep the application group running after the job completes&rdquo; check box on the Application Group page. This means that the lab will stay up and the job will keep running allowing you to use the VMs for your testing purposes.</p>
<p>You can set schedules if you want, though I just run my lab on demand.</p>
<p>Finally, go ahead and run the job. Over the next short while you&rsquo;ll see your lab VMs pop up in vCenter. When the job gets to 99% they&rsquo;re ready for you… but how?</p>
<h2 id="getting-into-the-lab"><strong>Getting into the Lab</strong></h2>
<p>Remember how we set a static IP for the proxy appliance and a masquerade IP range? Here&rsquo;s where we&rsquo;ll use them.</p>
<p>You can set a route on your local machine, pointing all traffic to that range to the proxy&rsquo;s IP address:</p>
<pre tabindex="0"><code>route -p ADD 10.1.1.2.0 MASK 255.255.255.0 10.1.1.199
</code></pre><p>This didn&rsquo;t work for me, and I ended up having to set the route on our core switching. The specifics of this will depend on your switch/router vendor, so talk to your network team if you&rsquo;re not sure.</p>
<p>Once that route is in place you should be able to ping or RDP the servers in your lab (assuming there is not firewalls in the way) using their masqueraded IP. For example if your SQL server is 10.1.1.10 in production, you can reach it via 10.1.2.10 now (note that this is only for prod to lab communication, the environment inside the lab knows no difference, so they all think they&rsquo;re on the original addresses.)</p>
<p>But what about getting internet access? Jump onto each VM that needs internet, and set a proxy address of that of the gateway (or whatever you set the proxy to) and whatever port you&rsquo;d configured, it defaults to 8080. That&rsquo;s it, you&rsquo;re good to go.</p>
<h2 id="tear-it-down-and-rebuild"><strong>Tear It Down (And Rebuild)</strong></h2>
<p>Back in the Veeam console, find your SureBackup job and click stop. It will power down each of the VMs and handle removing them from vCenter. You can now start this again at any time as and when you need it.</p>
<p>Each time you start the lab, you&rsquo;re VMs will be provisioned from the latest restore points, so refreshing your lab should be as simple as restarting the SureBackup job.</p>
<h2 id="the-bits-im-still-working-on"><strong>The Bits I&rsquo;m Still Working On</strong></h2>
<p>At the moment, I need to manually update DNS settings on each of my VMs, because the DNS server I&rsquo;m restoring isn&rsquo;t one of the two we general default to. I&rsquo;m also configuring the proxy settings for internet access by hand.</p>
<p>I&rsquo;m working on scripting this, so that redeploying the lab is even easier (and doesn&rsquo;t require my input if other people need it.)</p>
<h2 id="closing-thoughts"><strong>Closing Thoughts</strong></h2>
<p>That&rsquo;s it for getting started with a Veeam Virtual Lab. Are you using this feature, or are you a Veeam user that&rsquo;s been thinking about using SureBackup? Let me know your story/use cases in the comments below or over on <a href="https://twitter.com/WindosNZ" target="_blank" rel="noopener">Twitter</a>
.</p>
<p>Also, remember that if you&rsquo;re looking for <a href="https://king.geek.nz/2018/03/20/pshelp-twitter/" target="_blank" rel="noopener">PowerShell help</a>
, you can find it on Twitter using <a href="https://twitter.com/search?f=tweets&amp;vertical=default&amp;q=%23pshelp&amp;src=typd" target="_blank" rel="noopener">#PSHelp</a>
!</p>

  </article><div class="bg-blue-300 dark:bg-gray-900">
  <div class="container px-6 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
    <div>
      <div class="text-2xl font-bold mb-2">Follow me</div>
      <p class="opacity-60"></p>
    </div>
    <ul class="flex justify-center gap-4">

      <li>
        <a
          href="https://twitter.com/WindosNZ"
          target="_blank"
          rel="noopener"
          aria-label="Twitter"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"
            />
          </svg>
        </a>
      </li>


      <li>
        <a
          href="https://linkedin.com/in/windos"
          target="_blank"
          rel="noopener"
          aria-label="LinkedIn"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <line x1="8" y1="11" x2="8" y2="16" />
            <line x1="8" y1="8" x2="8" y2="8.01" />
            <line x1="12" y1="16" x2="12" y2="11" />
            <path d="M16 16v-3a2 2 0 0 0 -4 0" />
          </svg>
        </a>
      </li>



      <li>
        <a
          href="https://github.com/Windos"
          target="_blank"
          rel="noopener"
          aria-label="GitHub"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
            />
          </svg>
        </a>
      </li>





      <li>
        <a
          href="https://www.youtube.com/c/JoshuaKingSolari"
          target="_blank"
          rel="noopener"
          aria-label="YouTube"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="icon icon-tabler icon-tabler-brand-youtube"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <circle cx="12" cy="12" r="9" />
            <path d="M10 9l5 3l-5 3z" />
          </svg>
        </a>
      </li>




    </ul>
  </div>
</div>
    </main><footer class="container p-6 mx-auto flex justify-between items-center">
  <span class="text-sm font-light">

    Copyright © 2022 - Josh King · All rights reserved

  </span>
  <span onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-1 cursor-pointer">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M18 15l-6 -6l-6 6h12" />
    </svg>
  </span>
</footer>

<div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden">
  <div class="container max-w-3xl mx-auto p-12">
    <div class="relative">
      <div class="my-4 text-center text-2xl font-bold">Search</div>

      <span class="p-2 absolute right-0 top-0 cursor-pointer close-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </span>
    </div>

    <input type="search" class="py-2 px-3 w-full dark:text-black border dark:border-transparent"
      placeholder="Enter search query" />

    <div class="search-results text-lg font-medium my-4 hidden">Results</div>
    <ul class="search-list my-2">

    </ul>

    <div class="no-results text-center my-8 hidden">
      <div class="text-xl font-semibold mb-2">No results found</div>
      <p class="font-light text-sm">Try adjusting your search query</p>
    </div>
  </div>
</div>





<script src="https://blog.toastit.dev/js/scripts.min.js"></script>







<script>
  const mobileMenuButton = document.querySelector('.mobile-menu-button')
  const mobileMenu = document.querySelector('.mobile-menu')
  function toggleMenu() {
    mobileMenu.classList.toggle('hidden');
    mobileMenu.classList.toggle('flex');
  }
  if(mobileMenu && mobileMenuButton){
    mobileMenuButton.addEventListener('click', toggleMenu)
  }
</script>
</body>
</html>
